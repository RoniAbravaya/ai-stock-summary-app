# Settings for Backend (on Cloud Run).
# See https://firebase.google.com/docs/app-hosting/configure#cloud-run
runtime: nodejs18
entrypoint: node index.js

# Instance configuration
runConfig:
  minInstances: 0
  maxInstances: 1
  concurrency: 80
  cpu: 1
  memoryMiB: 512
  timeoutSeconds: 300
  startupTimeout: 300s

# Build and run scripts
scripts:
  buildCommand: "npm ci --production"
  runCommand: "node index.js"

# Environment variables and secrets
env:
  # Port configuration (required)
  - variable: PORT
    value: "8080"
    availability:
      - RUNTIME

  # Node environment
  - variable: NODE_ENV
    value: "production"
    availability:
      - RUNTIME

  # Logging configuration
  - variable: LOG_LEVEL
    value: "info"
    availability:
      - RUNTIME

# Health check configuration
healthCheck:
  initialDelaySeconds: 60
  timeoutSeconds: 30
  periodSeconds: 30
  failureThreshold: 3
  path: "/health"

# Output files configuration
outputFiles:
  serverApp:
    include: ["dist", "node_modules", "index.js", "package.json", "package-lock.json"]

# Grant access to secrets in Cloud Secret Manager.
# See https://firebase.google.com/docs/app-hosting/configure#secret-parameters
# - variable: MY_SECRET
#   secret: mySecretRef
